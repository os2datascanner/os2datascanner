{% load handle_extras %}
{% load i18n %}
{% load l10n %}
{% with type=document_report.matches.handle|find_type_label %}
  {% for frag in document_report.matches.matches %}
    {% if frag.rule.type_label in renderable_rules and frag.matches %}
      <tr data-type="{{ type }}">
        <td class="datatable__column--handle">
          <div class="ds-checkbox">
            <input type="checkbox" id="match-checkbox-{{ document_report.pk|unlocalize }}" value="" name="match-checkbox" class="datatable-checkbox" data-report-pk="{{ document_report.pk|unlocalize }}">
            <label for="match-checkbox-{{ document_report.pk|unlocalize }}">
              <span class="screen-reader-only">{% trans "Select result" %}</span>
            </label>
          </div>
        </td>

        <td class="datatable__column--name">
          <div class="tooltip">
            <div class="overflow-ellipsis">
              <strong data-tooltip-text>{{ document_report.matches.handle|present }}</strong>
            </div>
          </div>
          <div class="hit-link">
            <div class="button-group">
              {% if document_report.matches.handle|present_url %}
                <a href="{{ document_report.matches.handle|present_url }}" class="button" target="_blank" rel="noopener">
                  {% trans "Open" %}
                </a>
              {% endif %}
              {% if type != 'ews' %}
                <button class="button" data-clipboard-text="{{ document_report.matches.handle|find_parent:type|present }}">
                  {% trans "Copy" %}
                </button>
                {% if document_report.matches.handle|find_parent:type|find_file_folder %}
                  <a href="{{ document_report.matches.handle|find_parent:type|find_file_folder }}" class="button" target="_blank" rel="noopener">
                    {% trans "Open folder" %}
                  </a>
                {% endif %}
              {% endif %}
            </div>
          </div>
        </td>

        <td class="datatable__column--matchcount">
          {{ frag.matches|length }}
        </td>

        <td class="datatable__column--source">
          <span class="icon-filetype icon-filetype--{{ type }}">
          {% with svg_icon=type|find_svg_icon %}
            {% include svg_icon %}
          {% endwith %}
          </span>
        </td>

        {% comment %} path column {% endcomment%}
        <td class="datatable__column--path">
          <div class="tooltip">
            <div class="overflow-ellipsis">
              <span data-tooltip-text>{{ document_report.sort_key }}</span>
            </div>
          </div>
        </td>

        <td class="datatable__column--actions">
          <div class="button-group text-align-right">
            <button class="matches-handle button" type="button"
                    title="{% blocktrans %}OS2datascanner will not delete results from the system that was scanned.
Marking a result as handled will only remove the result from OS2datascanner.{% endblocktrans %}">
                {% trans "Handled" %}</button>
            <button class="matches-expand button button-caret" title="{% trans 'Show/hide matches' %}" type="button"><i class="material-icons" aria-hidden="true">expand_more</i></button>
          </div>
        </td>
      </tr>
      <tr class="matches-list" hidden>
        <td colspan="6">
          <table class="smaller datatable compressed">
            <colgroup>
              <col class="matches-list__column--match">
              <col class="matches-list__column--context">
              <col class="matches-list__column--probability" hidden>
            </colgroup>
            <thead>
              <th>{% trans "Anonymized match" %}</th>
              <th>{% trans "Context" %}</th>
              <th class="text-align-right matches-list__column--probability" hidden>{% trans "Probability" %}</th>
            </thead>
            <tbody>
              {% for match in frag.matches %}
                <tr>
                  <td>{{ match.match }}</td>
                  {% if match.context %}
                  <td class="match-context">{{ match.context }}</td>
                  {% endif %}
                  <td class="text-align-right matches-list__column--probability" hidden>{% include "components/probability.html"%}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </td>
      </tr>
    {% endif %}
  {% endfor %}
{% endwith %}
